{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Med Amine\\\\Desktop\\\\pfe\\\\main web\\\\git\\\\mini-storage-handler--pfe-\\\\frontend\\\\src\\\\Context\\\\DataContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useState, useEffect, useCallback } from 'react';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst DataContext = /*#__PURE__*/createContext();\nexport const useData = () => {\n  _s();\n  return useContext(DataContext);\n};\n_s(useData, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport const DataProvider = ({\n  children\n}) => {\n  _s2();\n  const [employees, setEmployees] = useState([]);\n  const [equipment, setEquipment] = useState([]);\n  const [attributions, setAttributions] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const [refreshTrigger, setRefreshTrigger] = useState(0); // This state triggers data re-fetch\n\n  // Combined data fetcher with caching\n  const fetchData = useCallback(async (endpoint, setData) => {\n    if (isLoading) return;\n    setIsLoading(true);\n    setError(null);\n    try {\n      const res = await axios.get(`http://localhost:5000/api/${endpoint}`);\n      setData(res.data);\n      return res.data;\n    } catch (err) {\n      setError(err.message);\n      console.error(`Error fetching ${endpoint}:`, err);\n      throw err;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [isLoading]);\n\n  // Fetch functions\n  const fetchEmployees = useCallback(() => fetchData('employees', setEmployees), [fetchData]);\n  const fetchEquipment = useCallback(() => fetchData('equipment', setEquipment), [fetchData]);\n  const fetchAttributions = useCallback(() => fetchData('attributions', setAttributions), [fetchData]);\n\n  // Initial data load with re-fetch trigger\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        setIsLoading(true);\n        const [empRes, eqRes, attrRes] = await Promise.all([axios.get('http://localhost:5000/api/employees'), axios.get('http://localhost:5000/api/equipment'), axios.get('http://localhost:5000/api/attributions')]);\n        setEmployees(empRes.data);\n        setEquipment(eqRes.data);\n        setAttributions(attrRes.data);\n      } catch (err) {\n        setError(err.message);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    fetchData();\n  }, [refreshTrigger]); // Re-fetch when refreshTrigger changes\n\n  // Return equipment\n  const returnEquipment = useCallback(async attributionId => {\n    setIsLoading(true);\n    try {\n      const res = await axios.put(`http://localhost:5000/api/attributions/${attributionId}/return`, {});\n\n      // Trigger re-fetch after returning equipment\n      setRefreshTrigger(prev => prev + 1); // Increment to trigger useEffect\n\n      // Update the attribution data and re-render UI\n      setAttributions(prev => prev.map(attr => attr.id_attribution === attributionId ? {\n        ...attr,\n        date_retour: res.data.date_retour,\n        isReturned: true\n      } : attr));\n      return res.data;\n    } catch (err) {\n      setError(err.message);\n      console.error(\"Error returning equipment:\", err);\n      throw err;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [attributions]);\n\n  // Delete attribution\n  const deleteAttribution = useCallback(async id_attribution => {\n    setIsLoading(true);\n    try {\n      await axios.delete(`http://localhost:5000/api/attributions/${id_attribution}`);\n      setAttributions(prev => prev.filter(attr => attr.id_attribution !== id_attribution));\n      return true;\n    } catch (err) {\n      setError(err.message);\n      console.error('Error deleting attribution:', err);\n      throw err;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [attributions]);\n  return /*#__PURE__*/_jsxDEV(DataContext.Provider, {\n    value: {\n      employees,\n      equipment,\n      attributions,\n      isLoading,\n      error,\n      fetchEmployees,\n      fetchEquipment,\n      fetchAttributions,\n      returnEquipment,\n      deleteAttribution,\n      setError\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 110,\n    columnNumber: 5\n  }, this);\n};\n_s2(DataProvider, \"PnXdsp6IDNtmOhY8QFI40D5eCZI=\");\n_c = DataProvider;\nvar _c;\n$RefreshReg$(_c, \"DataProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","useCallback","axios","jsxDEV","_jsxDEV","DataContext","useData","_s","DataProvider","children","_s2","employees","setEmployees","equipment","setEquipment","attributions","setAttributions","isLoading","setIsLoading","error","setError","refreshTrigger","setRefreshTrigger","fetchData","endpoint","setData","res","get","data","err","message","console","fetchEmployees","fetchEquipment","fetchAttributions","empRes","eqRes","attrRes","Promise","all","returnEquipment","attributionId","put","prev","map","attr","id_attribution","date_retour","isReturned","deleteAttribution","delete","filter","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/Med Amine/Desktop/pfe/main web/git/mini-storage-handler--pfe-/frontend/src/Context/DataContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect, useCallback } from 'react';\nimport axios from 'axios';\n\nconst DataContext = createContext();\n\nexport const useData = () => useContext(DataContext);\n\nexport const DataProvider = ({ children }) => {\n  const [employees, setEmployees] = useState([]);\n  const [equipment, setEquipment] = useState([]);\n  const [attributions, setAttributions] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const [refreshTrigger, setRefreshTrigger] = useState(0); // This state triggers data re-fetch\n\n  // Combined data fetcher with caching\n  const fetchData = useCallback(async (endpoint, setData) => {\n    if (isLoading) return;\n    setIsLoading(true);\n    setError(null);\n    try {\n      const res = await axios.get(`http://localhost:5000/api/${endpoint}`);\n      setData(res.data);\n      return res.data;\n    } catch (err) {\n      setError(err.message);\n      console.error(`Error fetching ${endpoint}:`, err);\n      throw err;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [isLoading]);\n\n  // Fetch functions\n  const fetchEmployees = useCallback(() => fetchData('employees', setEmployees), [fetchData]);\n  const fetchEquipment = useCallback(() => fetchData('equipment', setEquipment), [fetchData]);\n  const fetchAttributions = useCallback(() => fetchData('attributions', setAttributions), [fetchData]);\n\n  // Initial data load with re-fetch trigger\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        setIsLoading(true);\n        const [empRes, eqRes, attrRes] = await Promise.all([\n          axios.get('http://localhost:5000/api/employees'),\n          axios.get('http://localhost:5000/api/equipment'),\n          axios.get('http://localhost:5000/api/attributions')\n        ]);\n        setEmployees(empRes.data);\n        setEquipment(eqRes.data);\n        setAttributions(attrRes.data);\n      } catch (err) {\n        setError(err.message);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    fetchData();\n  }, [refreshTrigger]); // Re-fetch when refreshTrigger changes\n\n  // Return equipment\n  const returnEquipment = useCallback(async (attributionId) => {\n    setIsLoading(true);\n    try {\n      const res = await axios.put(\n        `http://localhost:5000/api/attributions/${attributionId}/return`,\n        {}\n      );\n\n      // Trigger re-fetch after returning equipment\n      setRefreshTrigger(prev => prev + 1);  // Increment to trigger useEffect\n\n      // Update the attribution data and re-render UI\n      setAttributions(prev =>\n        prev.map(attr =>\n          attr.id_attribution === attributionId\n            ? { ...attr, date_retour: res.data.date_retour, isReturned: true }\n            : attr\n        )\n      );\n\n      return res.data;\n    } catch (err) {\n      setError(err.message);\n      console.error(\"Error returning equipment:\", err);\n      throw err;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [attributions]);\n\n  // Delete attribution\n  const deleteAttribution = useCallback(async (id_attribution) => {\n    setIsLoading(true);\n    try {\n      await axios.delete(`http://localhost:5000/api/attributions/${id_attribution}`);\n      setAttributions(prev => prev.filter(attr => attr.id_attribution !== id_attribution));\n      return true;\n    } catch (err) {\n      setError(err.message);\n      console.error('Error deleting attribution:', err);\n      throw err;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [attributions]);\n\n  return (\n    <DataContext.Provider value={{\n      employees,\n      equipment,\n      attributions,\n      isLoading,\n      error,\n      fetchEmployees,\n      fetchEquipment,\n      fetchAttributions,\n      returnEquipment,\n      deleteAttribution,\n      setError\n    }}>\n      {children}\n    </DataContext.Provider>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}